(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{7099:function(e,l,t){Promise.resolve().then(t.bind(t,8868)),Promise.resolve().then(t.bind(t,3087)),Promise.resolve().then(t.bind(t,6271)),Promise.resolve().then(t.t.bind(t,3385,23))},8868:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return I}});var a=t(3827),s=t(4090),n=t(7907),r=t(146),i=t(9413),o=t(7929),c=t(8792);let u=()=>{let[e,l]=(0,s.useState)(""),[t,r]=(0,s.useState)(null),[u,d]=(0,s.useState)([]),m=(0,n.useRouter)();async function h(){let e=await (0,i.Z)("/locations"),l=await e.json();l&&r(function e(l){let t={children:{},isEndOfWord:l.isEndOfWord||!1,type:l.type||null};for(let a in l.children)t.children[a]=e(l.children[a].node);return t}(l))}(0,s.useEffect)(()=>{h()},[]);let x=(e,l)=>{if(!l||!e)return[];let t=[],a=(l,s)=>{for(let n in l.isEndOfWord&&s.toLowerCase().includes(e.toLowerCase())&&t.push(s),l.children)a(l.children[n],s?"".concat(s,", ").concat(n):n)};a(l,"");let s=t.map(e=>{let l=e.split(", ");return l.length>=2&&l[l.length-1]===l[l.length-2]?l.slice(0,-1).join(", "):e}),n=Array.from(new Set(s));console.log(n);let r=e.toLowerCase(),i=n[0].split(",")[0];return i.toLowerCase().startsWith(r)?[i,...n]:n};return(0,a.jsxs)("header",{className:"bg-white shadow-md flex justify-between items-center p-4 sticky top-0 z-50",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("img",{src:"/logo.webp",alt:"Refty",className:"h-8 w-8 mr-2"}),(0,a.jsx)(c.default,{href:"/",children:(0,a.jsx)("span",{className:"text-xl font-bold text-gray-800",children:"Refty"})})]}),(0,a.jsxs)("div",{className:"relative w-1/2",children:[(0,a.jsx)("input",{type:"text",value:e,onChange:e=>{let a=e.target.value;l(a),a.length>1?d(x(a,t)):d([])},placeholder:"\uD83D\uDD0D Start your search",className:"border p-2 rounded w-full pl-5 h-10"}),u.length>0&&(0,a.jsx)("ul",{className:"absolute top-full left-0 w-full bg-white border mt-1 rounded shadow-md z-50",children:u.slice(0,5).map((e,t)=>(0,a.jsx)("li",{className:"p-2 cursor-pointer hover:bg-gray-100",onClick:()=>{var t;l(t=(0,o.Ls)(e)),d([]),m.push("/?location=".concat(encodeURIComponent(t)))},children:(0,o.Ls)(e)},t))})]})]})};var d=t(8745),m=t(5460),h=t(4692);function x(){let[e,l]=(0,s.useState)(null),t=(0,n.useRouter)();(0,s.useEffect)(()=>{let e=localStorage.getItem("user");e&&l(JSON.parse(e))},[]);let r=async()=>{localStorage.removeItem("user"),document.cookie="auth_token=; Max-Age=0; path=/",sessionStorage.clear(),t.push("/auth")};return e?(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold mt-16 mb-4",children:"Profile"}),(0,a.jsxs)("p",{children:["Email: ",e.email]}),e.name&&(0,a.jsxs)("p",{children:["Name: ",e.name]}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(h.K,{onClick:r,children:"Logout"})})]}):null}let p=e=>{let{value:l,onChange:t,options:s}=e;return(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("select",{value:l,onChange:e=>t(e.target.value),className:"block w-full p-2 border rounded bg-sky-50",children:s.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})})},f=e=>{let{value:l,onChange:t}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Purpose"}),(0,a.jsx)(p,{value:l,onChange:e=>{t(e)},options:[{value:"for-rent",label:"For Rent"},{value:"for-sale",label:"For Sale"},{value:"",label:"All"}]})]})},v=e=>{let{onPriceChange:l}=e,[t,n]=(0,s.useState)(""),[r,i]=(0,s.useState)("");return(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Price Range"}),(0,a.jsxs)("div",{className:"flex space-x-4 mt-1",children:[(0,a.jsx)("input",{type:"number",value:t,onChange:e=>{n(e.target.value),l(e.target.value,r)},placeholder:"Min",className:"p-2 border rounded w-1/2"}),(0,a.jsx)("input",{type:"number",value:r,onChange:e=>{i(e.target.value),l(t,e.target.value)},placeholder:"Max",className:"p-2 border rounded w-1/2"})]})]})},j=e=>{let{value:l,onChange:t}=e;return(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Rooms"}),(0,a.jsx)(p,{value:l,onChange:t,options:[{value:"studio",label:"Studio"},{value:"1",label:"1 BR"},{value:"2",label:"2 BR"},{value:"3",label:"3 BR"},{value:"4",label:"4 BR"},{value:"5",label:"5 BR"},{value:"6",label:"6 BR"},{value:"7",label:"7 BR"},{value:"7+",label:"7+"}]})]})},g=e=>{let{value:l,onChange:t}=e;return(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Furnishing"}),(0,a.jsx)(p,{value:l,onChange:t,options:[{value:"furnished",label:"Furnished"},{value:"unfurnished",label:"Unfurnished"},{value:"partly",label:"Partly"}]})]})},b=e=>{let{onAreaChange:l}=e,[t,n]=(0,s.useState)(""),[r,i]=(0,s.useState)("");return(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Area"}),(0,a.jsxs)("div",{className:"flex space-x-4 mt-1",children:[(0,a.jsx)("input",{type:"number",value:t,onChange:e=>{n(e.target.value),l(e.target.value,r)},placeholder:"Min",className:"p-2 border rounded w-1/2"}),(0,a.jsx)("input",{type:"number",value:r,onChange:e=>{i(e.target.value),l(t,e.target.value)},placeholder:"Max",className:"p-2 border rounded w-1/2"})]})]})},y=e=>{let{value:l,onChange:t}=e;return(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Completion Status"}),(0,a.jsx)(p,{value:l,onChange:t,options:[{value:"completed",label:"Completed"},{value:"under-construction",label:"Under-Construction"},{value:"",label:"All"}]})]})},N=e=>{let{onApplyFilters:l}=e,[t,n]=(0,s.useState)({purpose:"for-rent",minPrice:"",maxPrice:"",city:"Dubai",district:["All Districts"],rooms:"studio",furnishing:"furnished",minArea:"",maxArea:"",completionStatus:"completed"});return(0,s.useEffect)(()=>{n({...t,district:["All Districts"]})},[t.city]),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsx)(f,{value:t.purpose,onChange:e=>n({...t,purpose:e})}),(0,a.jsx)(v,{onPriceChange:(e,l)=>n({...t,minPrice:e,maxPrice:l})}),(0,a.jsx)(j,{value:t.rooms,onChange:e=>n({...t,rooms:e})}),(0,a.jsx)(g,{value:t.furnishing,onChange:e=>n({...t,furnishing:e})}),(0,a.jsx)(b,{onAreaChange:(e,l)=>n({...t,minArea:e,maxArea:l})}),(0,a.jsx)(y,{value:t.completionStatus,onChange:e=>n({...t,completionStatus:e})}),(0,a.jsx)(h.K,{onClick:()=>{l(t)},children:"Apply Filters"})]})};var w=t(9381),C=t(3203);function S(e){let{userId:l,onClose:t}=e,{saved:n}=(0,w.Z)(l),[r,i]=(0,s.useState)("Properties");return(0,a.jsx)("div",{className:"",children:(0,a.jsxs)("div",{className:"rounded-md w-100",children:[(0,a.jsxs)("h2",{className:"text-lg font-bold mb-4",children:["Saved ",r]}),(0,a.jsx)("ul",{children:0===n.length?(0,a.jsx)("p",{children:"You haven't selected any favorite properties yet"}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4",children:n.map(e=>(0,a.jsx)(C.Z,{property:e,onClick:t},e.adId))})}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(h.K,{onClick:t,children:"Close"})})]})})}let k=e=>{let{onClose:l,type:t}=e;return(0,s.useEffect)(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]),(0,a.jsx)(d.M,{children:(0,a.jsx)(m.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-10 flex justify-center items-center",onClick:l,children:(0,a.jsx)(m.E.div,{initial:{y:50,opacity:0},animate:{y:0,opacity:1},exit:{y:50,opacity:0},className:"bg-sky-50 w-full h-full max-h-screen overflow-y-auto p-5 relative",onClick:e=>e.stopPropagation(),children:(0,a.jsx)("div",{className:"mt-16 mb-16",children:(e=>{switch(e){case"collections":return(0,a.jsx)("div",{children:"Подборки"});case"saved":return(0,a.jsx)(S,{userId:"123",onClose:l});case"search":l();case"filter":return(0,a.jsx)(N,{onApplyFilters:e=>{console.log(e),l()}});case"profile":return(0,a.jsx)(x,{});default:return null}})(t)})})})})};var P=t(5403),E=t(3565),A=t(2064),R=t(8350),_=t(3290);let B=[{id:1,type:"collections",title:"Collections",icon:P.B},{id:2,type:"saved",title:"Saved",icon:E.U},{id:3,type:"search",title:"Search",icon:A.Y},{id:4,type:"filter",title:"Filter",icon:R.E},{id:5,type:"profile",title:"Profile",icon:_.n}],D=e=>{let{onOpen:l,MenuItem:t,className:s,isActive:n}=e,r=t.icon;return(0,a.jsxs)("button",{onClick:l,className:"".concat(s," ").concat(n?"text-slate-700 bg-lime-100":"text-slate-950"),children:[(0,a.jsx)(r,{size:24,weight:n?"fill":"regular",className:n?"text-lime-600":"text-gray-600"}),(0,a.jsx)("p",{className:"text-center text-xs sm:text-sm",children:t.title})]})},F=()=>{let[e,l]=(0,s.useState)(!1),[t,n]=(0,s.useState)(null),r=e=>{t===e?(l(!1),n(null)):(n(e),l(!0))},i=()=>{l(!1),n(null)};return(0,a.jsxs)("footer",{children:[(0,a.jsx)("nav",{className:"fixed bottom-0 px-5 w-full shadow-lg flex items-center justify-between z-40 bg-white",children:B.map(e=>{let l=t===e.type;return(0,a.jsx)(D,{onOpen:()=>r(e.type),MenuItem:e,isActive:l,className:"flex flex-col items-center py-2 w-full"},e.id)})}),e&&(0,a.jsx)(k,{type:t,onClose:()=>i()})]})};function I(e){let{children:l}=e,t=(0,n.usePathname)(),o=(0,n.useSearchParams)(),c=(0,n.useRouter)(),d=t.startsWith("/auth"),[m,h]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{async function e(){if(!r.Z.get("auth_token")){c.replace("/auth");return}try{let e=await (0,i.Z)("/verify");(await e.json()).valid||(r.Z.remove("auth_token"),c.replace("/auth"))}catch(e){console.error("Auth check failed:",e),c.replace("/auth")}finally{h(!1)}}d?h(!1):e()},[t,o.toString(),d,c]),m)?null:(0,a.jsxs)("div",{className:"flex flex-col min-h-screen",children:[!d&&(0,a.jsx)(u,{}),(0,a.jsx)("main",{className:"flex-grow",children:l}),!d&&(0,a.jsx)(F,{})]})}},3087:function(e,l,t){"use strict";t.r(l);var a=t(4090),s=t(7907);l.default=()=>{let e=(0,s.useSearchParams)().get("userId"),[l,t]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{if(e&&!l){let e=document.createElement("script");return e.src="https://telegram.org/js/telegram-web-app.js",e.async=!0,e.onload=()=>t(!0),document.head.appendChild(e),()=>{document.head.contains(e)&&document.head.removeChild(e)}}},[e,l]),null}},3385:function(){}},function(e){e.O(0,[946,353,645,971,69,744],function(){return e(e.s=7099)}),_N_E=e.O()}]);